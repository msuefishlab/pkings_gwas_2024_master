Bootstrap: docker
From: bioconductor/bioconductor_docker:3.17
Stage: spython-base

%files
dnaml /usr/bin/dnaml
%post

# Install R packages
install2.r --error \
tidyverse \
ggthemes \
patchwork \
getopt \
yaml \
tools \
data.table \
reshape2 \
stringr \
ape \
quadprog \
igraph \
fastmatch \
phangorn

R -e 'BiocManager::install("gdsfmt")'
R -e 'BiocManager::install("SNPRelate")'

mkdir -p /snphylo/bin

apt-get update && \
apt-get install -y muscle phylip curl git python2

git clone https://github.com/thlee/SNPhylo.git

mv SNPhylo /snphylo

mkdir -p /snphylo/SNPhylo
cd /snphylo/SNPhylo

ln -s $(which /usr/bin/python2.7) /usr/bin/python

chmod +x /usr/bin/dnaml

printf "yyymusclenydnamln" | bash setup.sh

chmod -R 777 /snphylo

%runscript
cd /snphylo/SNPhylo
exec /bin/bash /bin/bash "$@"
%startscript
cd /snphylo/SNPhylo
exec /bin/bash /bin/bash "$@"
