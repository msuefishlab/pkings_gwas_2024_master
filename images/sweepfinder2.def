Bootstrap: docker
From: ubuntu:22.04

%help
    Singularity container for SweepFinder2 genome-wide sweep detection

    Contains:
    - SweepFinder2 (v1.0)
    - bcftools (v1.21)
    - Python 3 with dependencies

    Usage:
        singularity exec sweepfinder2.sif SweepFinder2 [options]

%labels
    Author Jason Gallant Lab
    Version 1.0
    SweepFinder2_Version 1.0

%environment
    export LC_ALL=C
    export PATH=/opt/SweepFinder2:$PATH

%post
    # Update and install dependencies
    apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y \
        build-essential \
        wget \
        git \
        zlib1g-dev \
        libbz2-dev \
        liblzma-dev \
        libcurl4-openssl-dev \
        libssl-dev \
        autoconf \
        automake \
        bcftools \
        python3 \
        python3-pip \
        && rm -rf /var/lib/apt/lists/*

    # Install SweepFinder2
    cd /opt
    git clone https://github.com/mdegiorgio/SweepFinder2.git
    cd SweepFinder2
    make

    # Verify installation
    ./SweepFinder2 || true

    # Install Python packages for data conversion
    pip3 install numpy pandas

    # Clean up
    apt-get clean

%runscript
    exec SweepFinder2 "$@"

%test
    # Test SweepFinder2 installation
    SweepFinder2 -h || true

    # Test bcftools installation
    bcftools --version

    # Test Python installation
    python3 --version
    python3 -c "import numpy; import pandas; print('Python packages OK')"
